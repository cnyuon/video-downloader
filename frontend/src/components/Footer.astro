---
/**
 * Footer - Site-wide footer with tool links, blog, and legal
 * Used on every page for consistent internal linking and crawlability
 */
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import type { ui } from '../i18n/ui';
import { getCollection } from 'astro:content';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Fetch recently updated blog posts for the current language
const posts = await getCollection('blog', ({ id }) => {
    return id.startsWith(`${lang}/`);
});

const recentPosts = posts
    .sort((a, b) => {
        const aDate = a.data.updatedDate || a.data.pubDate;
        const bDate = b.data.updatedDate || b.data.pubDate;
        return bDate.valueOf() - aDate.valueOf();
    })
    .slice(0, 3);

// Always prefix URLs with the language code except 'en'
const getHref = (path: string) => lang === 'en' ? path : `/${lang}${path === '/' ? '' : path}`;
---

<footer class="border-t py-12 mt-8">
    <div class="container mx-auto px-4 max-w-6xl">
        <div class="grid gap-8 md:grid-cols-3 mb-8">
            <!-- Brand -->
            <div>
                <a href={getHref('/')} class="flex items-center space-x-2 mb-3">
                    <div class="h-6 w-6 rounded-md bg-primary flex items-center justify-center">
                        <svg class="w-4 h-4 text-primary-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                    </div>
                    <span class="font-bold">MediaTools</span>
                </a>
                <p class="text-sm text-muted-foreground">{t('footer.desc')}</p>
            </div>

            <!-- Tools -->
            <div>
                <h3 class="font-semibold mb-3 text-sm">{t('footer.tools')}</h3>
                <ul class="space-y-2 text-sm text-muted-foreground">
                    <li><a href={getHref('/tiktok-downloader')} class="hover:text-foreground transition-colors">{t('nav.tiktok')}</a></li>
                    <li><a href={getHref('/twitter-downloader')} class="hover:text-foreground transition-colors">{t('nav.twitter')}</a></li>
                    <li><a href={getHref('/facebook-downloader')} class="hover:text-foreground transition-colors">{t('nav.facebook')}</a></li>
                    <li><a href={getHref('/tiktok-sound-downloader')} class="hover:text-foreground transition-colors">{t('nav.sound')}</a></li>
                    <li><a href={getHref('/video-to-mp3')} class="hover:text-foreground transition-colors">{t('nav.audio')}</a></li>
                    <li><a href={getHref('/thumbnail-grabber')} class="hover:text-foreground transition-colors">{t('nav.thumbnail')}</a></li>
                </ul>
            </div>

            <!-- Resources -->
            <div>
                <h3 class="font-semibold mb-3 text-sm">{t('footer.resources')}</h3>
                <ul class="space-y-2 text-sm text-muted-foreground">
                    <li><a href={getHref('/blog')} class="hover:text-foreground transition-colors">{t('nav.blog')}</a></li>
                    {recentPosts.map(post => {
                        const slug = post.slug.replace(/^(en|es|tr|pt|fr|ja|ko|hi)\//, '');
                        return (
                            <li>
                                <a href={getHref(`/blog/${slug}/`)} class="hover:text-foreground transition-colors line-clamp-1" title={post.data.title}>
                                    {post.data.title}
                                </a>
                            </li>
                        );
                    })}
                </ul>
            </div>
        </div>

        <div class="border-t pt-6 text-center text-sm text-muted-foreground">
            <p>{t('footer.copyright')}</p>
        </div>
    </div>
</footer>
